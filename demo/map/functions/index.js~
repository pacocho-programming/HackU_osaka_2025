const functions = require('firebase-functions');
const axios = require('axios');

// OSRM APIのエンドポイント
const osrm_url = "http://router.project-osrm.org/route/v1/driving/";

exports.calculateRoute = functions.https.onRequest((req, res) => {
    const { startLat, startLon, endLat, endLon } = req.query;

    const url = `${osrm_url}${startLon},${startLat};${endLon},${endLat}?overview=false`;

    axios.get(url)
        .then(response => {
            const data = response.data.routes[0].legs[0];
            const distance = data.distance / 1000; // km
            const duration = data.duration / 60;  // 分

            res.status(200).send({
                distance: distance,
                duration: duration
            });
        })
        .catch(error => {
            res.status(500).send({ error: error.message });
        });
});
